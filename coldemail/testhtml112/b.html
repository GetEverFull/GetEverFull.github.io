
    <!DOCTYPE html>
    <html>
      <head>
        <script id="handlebars" src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.min.js"></script>
        <script id="headtemplate" type="text/x-handlebars-template">
    
<style>:root { --color0: rgb(255, 0, 0); }</style></script>
        <script id="bodytemplate" type="text/x-handlebars-template">
    <p style="background-color: lch(from var(--color0) l c h / 1);">hello world</p>

</script>
        <script id="scriptsdata" type="application/json">[{"content":"\n        function updateImageTags() {\n            document.querySelectorAll(\"img[data-srcset]\").forEach(img => {\n                const dataSrcset = img.getAttribute(\"data-srcset\");\n                const dataSrc = img.getAttribute(\"data-src\");\n\n                if (dataSrcset && dataSrc) {\n                // Append the final webp version to srcset\n                const updatedSrcset = `${dataSrcset},${dataSrc.replace(/\\.\\w+$/, \".webp\")} 1024w`;\n\n                // Set new attributes\n                img.setAttribute(\"srcset\", updatedSrcset);\n                img.setAttribute(\"src\", dataSrc.replace(/\\.\\w+$/, \".webp\"));\n                img.style.opacity = \"1\";\n                }\n            });\n            }\n\n        // Run the function after the DOM is loaded\n        document.addEventListener(\"DOMContentLoaded\", updateImageTags);\n    ","src":"","type":"text/javascript"},{"content":"","src":"https://code.jquery.com/jquery-3.6.0.min.js","type":"text/javascript"},{"content":"","src":"https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js","type":"text/javascript"}]</script>
      </head>
      <body>
        <script id='fillerscript'>
          const htemplate = Handlebars.compile(document.getElementById("headtemplate").innerHTML);
          const btemplate = Handlebars.compile(document.getElementById("bodytemplate").innerHTML);

          const data = new URLSearchParams(window.location.search);
          let paramObject = {};
          data.forEach((value, key) => paramObject[key] = value);

          document.head.insertAdjacentHTML("beforeend", htemplate(paramObject));
          document.body.insertAdjacentHTML("beforeend", btemplate(paramObject));

          // Inject scripts manually
          const scriptsData = JSON.parse(document.getElementById("scriptsdata").innerHTML);
          scriptsData.forEach(({ content, src, type }) => {
            const script = document.createElement("script");
            script.type = type;
            if (src) {
              script.src = src;
              script.async = false; // Keep execution order
            } else {
              script.textContent = content;
            }
            document.head.appendChild(script);
          });
          for(const id of ["handlebars", "headtemplate", "bodytemplate", "scriptsdata", "fillerscript"]){
            document.getElementById(id).remove();
          }
        </script>
      </body>
    </html>